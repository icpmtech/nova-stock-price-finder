<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registo de Eventos de Stocks</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <main class="max-w-2xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">ðŸ“… Registo de Eventos de AÃ§Ãµes</h1>

    <!-- Pesquisa -->
    <div class="mb-6">
      <label class="block text-lg font-medium mb-2">Pesquisar Ticker:</label>
      <input type="text" id="searchInput" placeholder="Ex: SMCI, EDP, NVDA..." class="w-full border p-2 rounded" />
      <ul id="results" class="bg-white border rounded mt-1 shadow p-2"></ul>
    </div>

    <!-- Registo de Evento -->
    <form id="eventForm" class="bg-white p-4 rounded shadow space-y-4">
      <input type="text" id="title" placeholder="TÃ­tulo do Evento" class="w-full border p-2 rounded" required />
      <input type="text" id="symbol" placeholder="Ticker da AÃ§Ã£o" class="w-full border p-2 rounded bg-gray-100" required readonly />
      <input type="date" id="date" class="w-full border p-2 rounded" required />
      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">ðŸ’¾ Guardar Evento</button>
    </form>

    <!-- Lista de Eventos -->
    <section class="mt-8">
      <h2 class="text-2xl font-semibold mb-4">ðŸ“‘ Eventos Guardados</h2>
      <ul id="eventList" class="space-y-2 bg-white p-4 rounded shadow"></ul>
    </section>
  </main>

  <script>
    const searchInput = document.getElementById("searchInput");
    const results = document.getElementById("results");
    const eventForm = document.getElementById("eventForm");
    const eventList = document.getElementById("eventList");

    const mockTickers = ["SMCI", "EDP", "NVDA", "AAPL", "GOOGL", "TSLA", "MSFT", "BABA", "NIO", "SOFI", "KO", "PFE"];

    function renderEvents() {
      const events = JSON.parse(localStorage.getItem("stockEvents") || "[]");
      const today = new Date().toISOString().split("T")[0];
      eventList.innerHTML = "";

      events.filter(e => e.date >= today).forEach((e, index) => {
        const li = document.createElement("li");
        li.className = "border-b py-2";
        li.textContent = `${e.date} - ${e.title} (${e.symbol})`;
        eventList.appendChild(li);
        scheduleNotification(e.title, e.date);
      });
    }

    function scheduleNotification(title, date) {
      const eventDate = new Date(date);
      const now = new Date();
      const delay = eventDate.getTime() - now.getTime();

      if ("Notification" in window && delay > 0 && delay < 86400000) {
        setTimeout(() => {
          new Notification("ðŸ“¢ Evento de Stock", {
            body: title,
            icon: "https://cdn-icons-png.flaticon.com/512/1170/1170627.png"
          });
        }, delay);
      }
    }

    function requestNotificationPermission() {
      if ("Notification" in window && Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    }

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toUpperCase();
      results.innerHTML = "";

      if (query.length >= 2) {
        const matches = mockTickers.filter(t => t.includes(query));
        matches.forEach(ticker => {
          const li = document.createElement("li");
          li.className = "p-1 hover:bg-blue-100 cursor-pointer";
          li.textContent = ticker;
          li.onclick = () => {
            document.getElementById("symbol").value = ticker;
            results.innerHTML = "";
          };
          results.appendChild(li);
        });
      }
    });

    eventForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = document.getElementById("title").value;
      const symbol = document.getElementById("symbol").value;
      const date = document.getElementById("date").value;

      const events = JSON.parse(localStorage.getItem("stockEvents") || "[]");
      events.push({ title, symbol, date });
      localStorage.setItem("stockEvents", JSON.stringify(events));

      eventForm.reset();
      renderEvents();
    });

    document.addEventListener("DOMContentLoaded", () => {
      renderEvents();
      requestNotificationPermission();
    });
  </script>
</body>
</html>
