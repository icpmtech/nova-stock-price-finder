 async function fetchQuote(symbol) { const resp=await fetch(`/api?symbol=${symbol}`); if(!resp.ok)throw new Error('Falha ao obter dados da API'); return resp.json(); }
    function getRankExplanation(rank){switch(rank){case 1:return 'Strong Buy: Analistas esperam que a a√ß√£o supere o mercado.';case 2:return 'Buy: Expectativa de performance acima da m√©dia do mercado.';case 3:return 'Hold: Performance esperada em linha com o mercado.';case 4:return 'Sell: Performance esperada abaixo da m√©dia do mercado.';case 5:return 'Strong Sell: Analistas recomendam venda, pois desempenho dever√° ficar abaixo do mercado.';default:return '-';}}
    function computeZacksRankFromQuote(q){const momentumScore=q.changePercent>=0?1:5;let safetyScore;if(q.marketCap>=1e10)safetyScore=1;else if(q.marketCap>=2e9)safetyScore=2;else if(q.marketCap>=3e8)safetyScore=3;else safetyScore=4;const valueScore=Math.max(1,Math.min(5,Math.round(q.price/100)));const growthScore=3;return Math.round((valueScore+growthScore+momentumScore+safetyScore)/4);}    
    function getRankTitle(rank){return['Zacks Rank','Strong Buy','Buy','Hold','Sell','Strong Sell'][rank]||'Zacks Rank';}
    function updateRankCardStyle(rank){const card=document.getElementById('zacksRankCard');card.className='zacks-rank rank-'+rank;}
    function formatNumber(num){if(num>=1e12)return(num/1e12).toFixed(2)+'T';if(num>=1e9)return(num/1e9).toFixed(2)+'B';if(num>=1e6)return(num/1e6).toFixed(2)+'M';if(num>=1e3)return(num/1e3).toFixed(2)+'K';return num.toLocaleString();}
    function formatPercentage(percent){const v=(percent*100).toFixed(2);const c=percent>=0?'#00b894':'#ff6b6b';return`<span style='color:${c};font-weight:bold;'>${percent>=0?'+':''}${v}%</span>`;}
    function showLoading(){const btn=document.getElementById('analyzeBtn'),sp=document.getElementById('spinner'),txt=document.getElementById('btnText');btn.disabled=true;sp.style.display='inline-block';txt.textContent='Analisando...';document.getElementById('loadingOverlay').style.display='flex';}
    function hideLoading(){const btn=document.getElementById('analyzeBtn'),sp=document.getElementById('spinner'),txt=document.getElementById('btnText');btn.disabled=false;sp.style.display='none';txt.textContent='Analisar';document.getElementById('loadingOverlay').style.display='none';}
    function showResults(){const r=document.getElementById('results');r.classList.add('show');r.scrollIntoView({behavior:'smooth',block:'start'});}    
    function showError(msg){const rc=document.querySelector('.results-content'),ex=document.querySelector('.error-message');if(ex)ex.remove();const e=document.createElement('div');e.className='error-message';e.textContent=msg;rc.appendChild(e);showResults();}
    document.getElementById('ticker').addEventListener('keypress',e=>{if(e.key==='Enter')document.getElementById('analyzeBtn').click();});
    document.getElementById('analyzeBtn').addEventListener('click',async()=>{const t=document.getElementById('ticker').value.trim().toUpperCase();if(!t){showError('‚ö†Ô∏è Por favor, insira um ticker v√°lido.');return;}showLoading();try{await new Promise(r=>setTimeout(r,500));const q=await fetchQuote(t);const exE=document.querySelector('.error-message');if(exE)exE.remove();document.getElementById('price').innerHTML=`$${q.price.toLocaleString()}`;document.getElementById('changePercent').innerHTML=formatPercentage(q.changePercent);document.getElementById('volume').textContent=formatNumber(q.volume);document.getElementById('marketCap').textContent=`$${formatNumber(q.marketCap)}`;document.getElementById('forwardPE').textContent=q.forwardPE?`${q.forwardPE.toFixed(1)}x`:'N/A';document.getElementById('forwardSales').textContent=q.forwardSales?`${q.forwardSales.toFixed(1)}x`:'N/A';const rnk=computeZacksRankFromQuote(q);document.getElementById('zacksRank').textContent=rnk;document.getElementById('rankTitle').textContent=getRankTitle(rnk);document.getElementById('rankExplanation').textContent=getRankExplanation(rnk);updateRankCardStyle(rnk);if(q.forwardPE&&q.forwardSales&&q.industryAvgPE&&q.industryAvgSales){const peComp=q.forwardPE<q.industryAvgPE?'inferior':'superior';const salesComp=q.forwardSales<q.industryAvgSales?'inferior':'superior';const overall=q.forwardPE<q.industryAvgPE&&q.forwardSales<q.industryAvgSales?'inferiores':'superiores';const txt=`üìä Do ponto de vista de valuation, ${t} negocia atualmente a ${q.forwardPE.toFixed(1)}x lucros futuros e ${q.forwardSales.toFixed(1)}x vendas futuras.<br><br>üìà O m√∫ltiplo P/E √© ${peComp} √† m√©dia da ind√∫stria (${q.industryAvgPE.toFixed(1)}x), enquanto o P/S √© ${salesComp} √† m√©dia setorial (${q.industryAvgSales.toFixed(1)}x).<br><br>üéØ Ambos os m√∫ltiplos s√£o ${overall} √† m√©dia da ind√∫stria, indicando que a a√ß√£o est√° ${overall==='inferiores'?'potencialmente subvalorizada':'potencialmente sobrevalorizada'} em rela√ß√£o aos pares do setor.`;document.getElementById('valuation').innerHTML=txt;}else{document.getElementById('valuation').innerHTML='üìä Dados de valuation n√£o dispon√≠veis para an√°lise comparativa no momento.';}showResults();}catch(err){console.error(err);showError('‚ùå Erro ao buscar dados da a√ß√£o. Verifique o ticker e tente novamente.');}finally{hideLoading();}});
    document.getElementById('ticker').focus();