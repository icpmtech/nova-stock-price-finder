<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌍 Global Markets Analytics Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif']
          },
          colors: {
           primary: '#1E3A8A', // Indigo-800
        accent: '#06B6D4',  // Cyan-500
        warning: '#F59E0B', // Amber-500
        surface: '#F3F4F6', // Zinc-100
        darksurface: '#0D1117',
        darkcard: '#161B22'
          },
          animation: {
            'fade-in': 'fadeIn 0.6s ease-out',
            'slide-up': 'slideUp 0.8s ease-out',
            'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
            'bounce-subtle': 'bounceSubtle 1s ease-out'
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 102, 255, 0.3); }
      50% { box-shadow: 0 0 30px rgba(0, 102, 255, 0.6); }
    }
    
    @keyframes bounceSubtle {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }
    
    .glass {
      background: #d8b3fd;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .dark .glass {
      background: rgba(26, 31, 46, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .dark .gradient-bg {
      background: linear-gradient(135deg, #1a1f2e 0%, #0a0e1a 100%);
    }
    
    .market-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateY(0);
    }
    
    .market-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    .dark .market-card:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body class="gradient-bg text-gray-900 dark:text-gray-100 min-h-screen">
  <!-- Navigation Header -->
  <nav class="glass sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-4">
          <div class="animate-pulse-glow">
            <h1 id="title" class="text-xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">
              🌍 Global Markets Analytics Hub
            </h1>
          </div>
          <div class="hidden sm:block">
            <span class="text-xs bg-accent text-white px-2 py-1 rounded-full animate-bounce-subtle">LIVE</span>
          </div>
        </div>
        
        <div class="flex items-center space-x-3">
          <select id="langSelect" onchange="changeLanguage()" class="glass text-sm px-3 py-2 rounded-lg border-0 focus:ring-2 focus:ring-primary">
            <option value="pt">🇵🇹 PT</option>
            <option value="en">🇺🇸 EN</option>
            <option value="fr">🇫🇷 FR</option>
          </select>
          <button onclick="toggleDarkMode()" class="glass p-2 rounded-lg hover:bg-primary hover:text-white transition-all duration-300">
            <span id="themeIcon">🌓</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Hero Section -->
    <div class="text-center mb-12 animate-fade-in">
      <p id="description" class="text-xl text-gray-700 dark:text-gray-300 mb-6 font-light">
        Explore real-time market data with advanced analytics
      </p>
      <div class="flex justify-center space-x-4 mb-8">
        <div class="glass px-4 py-2 rounded-full">
          <span class="text-sm font-medium">📈 Real-time Data</span>
        </div>
        <div class="glass px-4 py-2 rounded-full">
          <span class="text-sm font-medium">📊 Advanced Charts</span>
        </div>
        <div class="glass px-4 py-2 rounded-full">
          <span class="text-sm font-medium">🔍 Deep Analytics</span>
        </div>
      </div>
    </div>

    <!-- Market Overview Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12 animate-slide-up">
      <div class="glass rounded-xl p-6 text-center">
        <div class="text-3xl mb-2">📈</div>
        <div class="text-2xl font-bold text-accent" id="totalMarkets">5</div>
        <div class="text-sm text-gray-600 dark:text-gray-400" data-key="totalMarkets">Active Markets</div>
      </div>
      <div class="glass rounded-xl p-6 text-center">
        <div class="text-3xl mb-2">💹</div>
        <div class="text-2xl font-bold text-green-500" id="gainers">+2.4%</div>
        <div class="text-sm text-gray-600 dark:text-gray-400" data-key="avgGain">Avg Gain Today</div>
      </div>
      <div class="glass rounded-xl p-6 text-center">
        <div class="text-3xl mb-2">🔥</div>
        <div class="text-2xl font-bold text-warning" id="volume">$2.1B</div>
        <div class="text-sm text-gray-600 dark:text-gray-400" data-key="volume">Total Volume</div>
      </div>
      <div class="glass rounded-xl p-6 text-center">
        <div class="text-3xl mb-2">⚡</div>
        <div class="text-2xl font-bold text-primary" id="updates">Live</div>
        <div class="text-sm text-gray-600 dark:text-gray-400" data-key="status">Status</div>
      </div>
    </div>

    <!-- Main Markets Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
      <!-- PSI Market Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.1s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">🇵🇹</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">PSI 20</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="psi">Lisbon Stock Exchange</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-green-500">+1.2%</div>
            <div class="text-xs text-gray-500">6,247.8</div>
          </div>
        </div>
        <div class="h-20 mb-4">
          <canvas id="psiChart" width="300" height="80"></canvas>
        </div>
        <a href="/psi20.html" class="block w-full bg-primary text-white text-center py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
          <span data-key="viewDetails">View Details</span> →
        </a>
      </div>

      <!-- IBEX Market Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.2s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">🇪🇸</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">IBEX 35</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="ibex">Spanish Blue Chips</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-red-500">-0.8%</div>
            <div class="text-xs text-gray-500">9,742.1</div>
          </div>
        </div>
        <div class="h-20 mb-4">
          <canvas id="ibexChart" width="300" height="80"></canvas>
        </div>
        <a href="/ibex35.html" class="block w-full bg-primary text-white text-center py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
          <span data-key="viewDetails">View Details</span> →
        </a>
      </div>

      <!-- NASDAQ Market Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.3s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">🇺🇸</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">NASDAQ</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="nasdaq">Tech Innovation</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-green-500">+2.1%</div>
            <div class="text-xs text-gray-500">14,826.3</div>
          </div>
        </div>
        <div class="h-20 mb-4">
          <canvas id="nasdaqChart" width="300" height="80"></canvas>
        </div>
        <a href="/nasdaq.html" class="block w-full bg-primary text-white text-center py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
          <span data-key="viewDetails">View Details</span> →
        </a>
      </div>

      <!-- CAC 40 Market Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.4s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">🇫🇷</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">CAC 40</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="paris">French Market</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-green-500">+0.9%</div>
            <div class="text-xs text-gray-500">7,521.4</div>
          </div>
        </div>
        <div class="h-20 mb-4">
          <canvas id="cacChart" width="300" height="80"></canvas>
        </div>
        <a href="/cac40.html" class="block w-full bg-primary text-white text-center py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
          <span data-key="viewDetails">View Details</span> →
        </a>
      </div>

      <!-- Analytics Hub Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.5s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">📊</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">Analytics Hub</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="analytics">Advanced Tools</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-accent">NEW</div>
            <div class="text-xs text-gray-500">Beta</div>
          </div>
        </div>
        <div class="mb-4">
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="bg-primary/10 p-2 rounded text-center">
              <div class="font-semibold">Heat Map</div>
            </div>
            <div class="bg-accent/10 p-2 rounded text-center">
              <div class="font-semibold">Correlation</div>
            </div>
            <div class="bg-warning/10 p-2 rounded text-center">
              <div class="font-semibold">Volatility</div>
            </div>
            <div class="bg-green-500/10 p-2 rounded text-center">
              <div class="font-semibold">Trends</div>
            </div>
          </div>
        </div>
        <button onclick="openAnalyticsModal()" class="block w-full bg-gradient-to-r from-primary to-accent text-white text-center py-3 rounded-lg hover:opacity-90 transition-all duration-300 transform hover:scale-105">
          <span data-key="openAnalytics">Open Analytics</span> 📈
        </button>
      </div>

      <!-- API Access Card -->
      <div class="market-card glass rounded-xl p-6 animate-fade-in" style="animation-delay: 0.6s;">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center space-x-3">
            <div class="text-2xl">🔧</div>
            <div>
              <h3 class="text-lg font-semibold text-primary dark:text-blue-300">API Access</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400" data-key="api">Developer Tools</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold text-green-500">✓</div>
            <div class="text-xs text-gray-500">Active</div>
          </div>
        </div>
        <div class="mb-4">
          <div class="text-xs space-y-1">
            <div class="flex justify-between">
              <span>REST API:</span>
              <span class="text-green-500">Online</span>
            </div>
            <div class="flex justify-between">
              <span>WebSocket:</span>
              <span class="text-green-500">Connected</span>
            </div>
            <div class="flex justify-between">
              <span>Rate Limit:</span>
              <span class="text-yellow-500">1000/hr</span>
            </div>
          </div>
        </div>
        <a href="https://nova-stock-price-finder.vercel.app/api" class="block w-full bg-primary text-white text-center py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
          <span data-key="viewEndpoints">View Endpoints</span> →
        </a>
      </div>
    </div>

    <!-- Quick Analytics Section -->
    <div class="glass rounded-xl p-8 mb-12 animate-slide-up">
      <h2 class="text-2xl font-bold mb-6 text-center" data-key="quickAnalytics">Quick Market Analytics</h2>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
          <h3 class="text-lg font-semibold mb-4" data-key="marketTrends">Market Trends</h3>
          <canvas id="trendsChart" width="400" height="200"></canvas>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4" data-key="sectorPerformance">Sector Performance</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded">
              <span>Technology</span>
              <span class="text-green-600 font-semibold">+3.2%</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded">
              <span>Healthcare</span>
              <span class="text-blue-600 font-semibold">+1.8%</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-red-50 dark:bg-red-900/20 rounded">
              <span>Energy</span>
              <span class="text-red-600 font-semibold">-1.4%</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded">
              <span>Finance</span>
              <span class="text-yellow-600 font-semibold">+0.3%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Modal -->
  <div id="analyticsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="glass rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold" data-key="advancedAnalytics">Advanced Analytics Dashboard</h2>
          <button onclick="closeAnalyticsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="glass p-4 rounded-lg">
            <h3 class="font-semibold mb-3">Market Correlation Matrix</h3>
            <canvas id="correlationChart" width="300" height="300"></canvas>
          </div>
          <div class="glass p-4 rounded-lg">
            <h3 class="font-semibold mb-3">Volatility Analysis</h3>
            <canvas id="volatilityChart" width="300" height="300"></canvas>
          </div>
          <div class="glass p-4 rounded-lg">
            <h3 class="font-semibold mb-3">Volume Distribution</h3>
            <canvas id="volumeChart" width="300" height="300"></canvas>
          </div>
          <div class="glass p-4 rounded-lg">
            <h3 class="font-semibold mb-3">Performance Metrics</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between"><span>Sharpe Ratio:</span><span class="font-semibold">1.42</span></div>
              <div class="flex justify-between"><span>Beta:</span><span class="font-semibold">0.89</span></div>
              <div class="flex justify-between"><span>Alpha:</span><span class="font-semibold">2.1%</span></div>
              <div class="flex justify-between"><span>Max Drawdown:</span><span class="font-semibold text-red-500">-12.3%</span></div>
              <div class="flex justify-between"><span>VaR (95%):</span><span class="font-semibold">-2.8%</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="glass mt-16 py-8">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <div class="text-sm text-gray-600 dark:text-gray-400">
          <span data-key="developedBy">Developed by</span> <strong>Pedro Martins</strong>
        </div>
        <div class="flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400">
          <span id="footer" data-key="lastUpdate">Last updated:</span>
          <span id="now" class="font-mono"></span>
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
        </div>
      </div>
    </div>
  </footer>
<script type="module" src="/public/marketApis.js"></script>



<script type="module">
import {
  getPSIData,
  getIBEXData,
  getNASDAQData,
  getParisData
} from '/public/marketApis.js';

// Translations object
const translations = {
  pt: {
    title:             "🌍 Global Markets Analytics Hub",
    description:       "Explore dados de mercado em tempo real com análises avançadas",
    lastUpdate:        "Última atualização:",
    developedBy:       "Desenvolvido por",
    psi:               "Ações da bolsa de Lisboa",
    ibex:              "Principais empresas espanholas",
    nasdaq:            "Tecnologia e inovação",
    paris:             "Mercado francês",
    api:               "Ferramentas para programadores",
    analytics:         "Ferramentas Avançadas",
    totalMarkets:      "Mercados Ativos",
    avgGain:           "Ganho Médio Hoje",
    volume:            "Volume Total",
    status:            "Estado",
    viewDetails:       "Ver Detalhes",
    openAnalytics:     "Abrir Analytics",
    viewEndpoints:     "Ver Endpoints",
    quickAnalytics:    "Análises Rápidas de Mercado",
    marketTrends:      "Tendências de Mercado",
    sectorPerformance: "Performance por Setor",
    advancedAnalytics: "Dashboard de Analytics Avançado"
  },
  en: {
    title:             "🌍 Global Markets Analytics Hub",
    description:       "Explore real-time market data with advanced analytics",
    lastUpdate:        "Last updated:",
    developedBy:       "Developed by",
    psi:               "Lisbon Stock Exchange",
    ibex:              "Top Spanish companies",
    nasdaq:            "Technology and innovation",
    paris:             "French market",
    api:               "Developer tools",
    analytics:         "Advanced Tools",
    totalMarkets:      "Active Markets",
    avgGain:           "Avg Gain Today",
    volume:            "Total Volume",
    status:            "Status",
    viewDetails:       "View Details",
    openAnalytics:     "Open Analytics",
    viewEndpoints:     "View Endpoints",
    quickAnalytics:    "Quick Market Analytics",
    marketTrends:      "Market Trends",
    sectorPerformance: "Sector Performance",
    advancedAnalytics: "Advanced Analytics Dashboard"
  },
  fr: {
    title:             "🌍 Hub d'Analytics des Marchés Globaux",
    description:       "Explorez les données de marché en temps réel avec des analyses avancées",
    lastUpdate:        "Dernière mise à jour:",
    developedBy:       "Développé par",
    psi:               "Actions de la bourse de Lisbonne",
    ibex:              "Principales entreprises espagnoles",
    nasdaq:            "Technologie et innovation",
    paris:             "Marché français",
    api:               "Outils développeur",
    analytics:         "Outils Avancés",
    totalMarkets:      "Marchés Actifs",
    avgGain:           "Gain Moyen Aujourd'hui",
    volume:            "Volume Total",
    status:            "Statut",
    viewDetails:       "Voir Détails",
    openAnalytics:     "Ouvrir Analytics",
    viewEndpoints:     "Voir Endpoints",
    quickAnalytics:    "Analytics Rapide du Marché",
    marketTrends:      "Tendances du Marché",
    sectorPerformance: "Performance Sectorielle",
    advancedAnalytics: "Tableau de Bord Analytics Avancé"
  }
};

// Chart.js colors and instances
const primaryColors = {
  psi:    '#10B981',
  ibex:   '#EF4444',
  nasdaq: '#3B82F6',
  paris:  '#8B5CF6'
};
const charts = {};

// Initialize a market card: value, percent change, mini-chart
async function initMarket(key, fetchFn) {
  const data = await fetchFn();
  const prices = data.map(d => parseFloat(d.price));
  const avgPct = (data.reduce((sum, d) => sum + parseFloat(d.percent), 0) / data.length).toFixed(2) + '%';
  const lastPrice = prices[prices.length - 1].toFixed(2);

  document.getElementById(key + 'Change').textContent = avgPct;
  document.getElementById(key + 'Value').textContent = lastPrice;

  if (charts[key]) {
    charts[key].data.datasets[0].data = prices;
    charts[key].update();
  } else {
    const ctx = document.getElementById(key + 'Chart').getContext('2d');
    charts[key] = new Chart(ctx, {
      type: 'line',
      data: {
        labels: prices.map((_, i) => i),
        datasets: [{
          data: prices,
          borderColor: primaryColors[key],
          fill: false,
          pointRadius: 0
        }]
      },
      options: {
        responsive: true,
        scales: { x: { display: false }, y: { display: false } },
        plugins: { legend: { display: false } }
      }
    });
  }
}

// Refresh all market cards & header stats
async function refreshAll() {
  document.getElementById('totalMarkets').textContent = Object.keys(primaryColors).length;
  await Promise.all([
    initMarket('psi', getPSIData),
    initMarket('ibex', getIBEXData),
    initMarket('nasdaq', getNASDAQData),
    initMarket('paris', getParisData)
  ]);
  // Simulated header stats
  document.getElementById('avgGain').textContent = (Math.random() * 4 - 1).toFixed(2) + '%';
  document.getElementById('volume').textContent  = '$' + (1 + Math.random() * 4).toFixed(1) + 'B';
  document.getElementById('status').textContent  = 'Live';
}

// Initialize the Quick Analytics Trends chart
function initializeCharts() {
  new Chart(document.getElementById('trendsChart'), {
    type: 'line',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun'],
      datasets: [
        { label: 'PSI',    data: [6100,6150,6080,6200,6250,6247], borderColor: '#10B981', tension: 0.4 },
        { label: 'IBEX',   data: [9800,9750,9900,9850,9780,9742], borderColor: '#EF4444', tension: 0.4 },
        { label: 'NASDAQ', data: [14500,14600,14400,14700,14800,14826], borderColor: '#3B82F6', tension: 0.4 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { beginAtZero: false } }
    }
  });
}

// Advanced Analytics Modal charts
function initializeAnalyticsCharts() {
  // Correlation scatter
  new Chart(document.getElementById('correlationChart'), {
    type: 'scatter',
    data: {
      datasets: [{
        label: 'PSI vs NASDAQ',
        data: [
          {x:0.1,y:0.8},{x:0.3,y:0.7},{x:0.5,y:0.9},
          {x:0.2,y:0.6},{x:0.4,y:0.75},{x:0.6,y:0.85}
        ],
        backgroundColor: 'rgba(59, 130, 246, 0.6)',
        borderColor: '#3B82F6'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: true } },
      scales: {
        x: { title: { display: true, text: 'PSI Returns' } },
        y: { title: { display: true, text: 'NASDAQ Returns' } }
      }
    }
  });

  // Volatility bar
  new Chart(document.getElementById('volatilityChart'), {
    type: 'bar',
    data: {
      labels: ['PSI','IBEX','NASDAQ','CAC'],
      datasets: [{
        label: 'Volatility (%)',
        data: [15.2,18.7,22.1,16.8],
        backgroundColor: [
          'rgba(16,185,129,0.7)',
          'rgba(239,68,68,0.7)',
          'rgba(59,130,246,0.7)',
          'rgba(139,92,246,0.7)'
        ],
        borderColor: ['#10B981','#EF4444','#3B82F6','#8B5CF6'],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, title: { display: true, text: 'Volatility (%)' } } }
    }
  });

  // Volume distribution doughnut
  new Chart(document.getElementById('volumeChart'), {
    type: 'doughnut',
    data: {
      labels: ['PSI','IBEX','NASDAQ','CAC','Others'],
      datasets: [{
        data: [15,25,35,20,5],
        backgroundColor: ['#10B981','#EF4444','#3B82F6','#8B5CF6','#F59E0B'],
        borderColor: '#ffffff',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });
}

// Modal controls
function openAnalyticsModal() {
  document.getElementById('analyticsModal').classList.remove('hidden');
  setTimeout(initializeAnalyticsCharts, 100);
}
function closeAnalyticsModal() {
  document.getElementById('analyticsModal').classList.add('hidden');
}

// Dark mode toggle
function toggleDarkMode() {
  const isDark = document.documentElement.classList.toggle('dark');
  document.getElementById('themeIcon').textContent = isDark ? '☀️' : '🌙';
  window.userPreferences = { darkMode: isDark, language: window.userPreferences?.language || 'pt' };
}

// Language switch
function changeLanguage() {
  const lang = document.getElementById('langSelect').value;
  const t = translations[lang];

  // Atualiza todos os elementos com data-key
  Object.keys(t).forEach(key => {
    document.querySelectorAll(`[data-key="${key}"]`).forEach(el => {
      el.textContent = t[key];
    });
  });

  // Atualiza elementos individuais, se existirem
  const titleEl = document.getElementById('title');
  if (titleEl) titleEl.textContent = t.title;

  const descEl = document.getElementById('description');
  if (descEl) descEl.textContent = t.description;

  const footerEl = document.getElementById('footer');
  if (footerEl) footerEl.textContent = t.lastUpdate;

  // Persiste preferência
  window.userPreferences = { 
    darkMode: window.userPreferences?.darkMode || false, 
    language: lang 
  };
}


// Header stats simulation
function updateMarketData() {
  const gains   = ['+2.1%','+2.8%','+1.9%','+3.2%'];
  const volumes = ['$2.1B','$2.3B','$1.9B','$2.5B'];
  document.getElementById('gainers').textContent = gains[Math.floor(Math.random()*gains.length)];
  document.getElementById('volume'). textContent = volumes[Math.floor(Math.random()*volumes.length)];
}

// On page load
document.addEventListener('DOMContentLoaded', () => {
  // Restore preferences
  const prefs = window.userPreferences || { darkMode: false, language: 'pt' };
  if (prefs.darkMode) toggleDarkMode();
  document.getElementById('langSelect').value = prefs.language;
  changeLanguage();

  // Initialize
  refreshAll();
  initializeCharts();

  // Intervals
  setInterval(refreshAll, 20000);
  setInterval(updateMarketData, 30000);
  setInterval(() => {
    document.getElementById('now').textContent = new Date().toLocaleString();
  }, 60000);

  // Close modal on outside click
  document.getElementById('analyticsModal').addEventListener('click', e => {
    if (e.target === e.currentTarget) closeAnalyticsModal();
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeAnalyticsModal();
    if (e.ctrlKey && e.key === 'd') {
      e.preventDefault();
      toggleDarkMode();
    }
  });

  // Smooth scroll
  document.querySelectorAll('a[href^="#"]').forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      document.querySelector(a.getAttribute('href'))?.scrollIntoView({ behavior:'smooth' });
    });
  });
});
</script>



</body>
</html>