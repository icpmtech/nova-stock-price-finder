<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Ativos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'bounce-in': 'bounceIn 0.5s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(-10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            bounceIn: {
              '0%': { transform: 'scale(0.8)', opacity: '0' },
              '50%': { transform: 'scale(1.05)', opacity: '1' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
          },
        },
      },
    };
  </script>
  <style>
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .floating-shadow {
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                  0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      transition: all 0.3s ease;
    }
    .pulse-border {
      animation: pulse-border 2s infinite;
    }
    @keyframes pulse-border {
      0%,100% { border-color: rgba(59,130,246,0.5); }
      50%    { border-color: rgba(59,130,246,1); }
    }
  </style>
</head>
<body class="min-h-screen gradient-bg">
    <div class="glass-effect sticky top-0 z-50 animate-slide-in"  id="header-widget" ></div>
  <!-- 2) Include the widget script -->
<script type="module" src="header.js"></script>
  <!-- Header -->
  <header class="glass-effect sticky top-0 z-10 animate-slide-in">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
        </div>
        <h1 class="text-2xl font-bold text-gray-800">Gestão de Ativos</h1>
      </div>
      <div class="flex space-x-4">
        <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
          <span id="assetCount">0</span> Ativos
        </div>
        <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
          Valor Total: $<span id="totalValue">0.00</span>
        </div>
      </div>
    </div>
    
  </header>

  <main class="container mx-auto px-6 py-8">
    <!-- Formulário -->
    <div class="glass-effect floating-shadow rounded-2xl p-6 mb-8 animate-fade-in">
      <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
        Adicionar / Atualizar Ativo
      </h2>
      <form id="form" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div><label class="block text-sm">Nome</label><input id="name" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" required /></div>
          <div><label class="block text-sm">Tipo</label><select id="type" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" required>
            <option value="">Selecione...</option>
            <option value="Ação">Ação</option><option value="Criptomoeda">Cripto</option>
            <option value="ETF">ETF</option><option value="Obrigação">Obrigação</option>
            <option value="Commodity">Commodity</option><option value="REIT">REIT</option>
          </select></div>
          <div><label class="block text-sm">Setor</label><input id="sector" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" /></div>
          <div><label class="block text-sm">País</label><input id="country" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" /></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div><label class="block text-sm">Risco</label><select id="risk" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus">
            <option value="">Selecione...</option>
            <option value="Baixo">Baixo</option><option value="Médio">Médio</option><option value="Alto">Alto</option>
          </select></div>
          <div><label class="block text-sm">Quantidade</label><input id="quantity" type="number" step="0.01" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" required /></div>
          <div><label class="block text-sm">Preço (USD)</label><input id="priceUSD" type="number" step="0.01" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" required /></div>
          <div><label class="block text-sm">Variação (%)</label><input id="change" type="number" step="0.01" class="w-full border-2 border-gray-200 p-3 rounded-lg input-focus" /></div>
        </div>
        <button type="submit" id="btnText" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 hover-lift">
          <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
          Salvar
        </button>
      </form>
    </div>

    <!-- Filtro -->
    <div class="glass-effect floating-shadow rounded-2xl p-6 mb-8 animate-fade-in">
      <div class="flex flex-col md:flex-row gap-4">
        <input id="searchInput" placeholder="Pesquisar..." class="flex-1 border-2 border-gray-200 p-3 rounded-lg input-focus" />
        <select id="filterType" class="border-2 border-gray-200 p-3 rounded-lg input-focus">
          <option value="">Todos Tipos</option>
          <option value="Ação">Ação</option><option value="Criptomoeda">Cripto</option>
          <option value="ETF">ETF</option>
        </select>
        <select id="filterRisk" class="border-2 border-gray-200 p-3 rounded-lg input-focus">
          <option value="">Todos Riscos</option>
          <option value="Baixo">Baixo</option><option value="Médio">Médio</option><option value="Alto">Alto</option>
        </select>
      </div>
    </div>

    <!-- Tabela -->
    <div class="glass-effect floating-shadow rounded-2xl overflow-hidden animate-fade-in">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
            <tr>
              <th class="p-4 text-left font-semibold">Nome</th><th class="p-4">Tipo</th><th class="p-4">Setor</th>
              <th class="p-4">País</th><th class="p-4">Risco</th><th class="p-4">Qtd</th>
              <th class="p-4">Preço</th><th class="p-4">Variação</th><th class="p-4">Total</th><th class="p-4">Ações</th>
            </tr>
          </thead>
          <tbody id="list" class="divide-y divide-gray-100"></tbody>
        </table>
        <div id="emptyState" class="text-center py-16 hidden">
          <h3 class="text-lg font-medium text-gray-700 mb-2">Nenhum ativo</h3>
          <p class="text-gray-500">Adicione um ativo para começar</p>
        </div>
      </div>
    </div>
  </main>
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 md:hidden">
  <div class="flex justify-around py-2">
    <!-- Início -->
    <button onclick="location.href='index.html'" class="flex flex-col items-center p-2 text-blue-600 hover:text-blue-700">
      <svg class="w-5 h-5 mb-1" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
      </svg>
      <span class="text-xs font-medium" data-i18n="nav.home">Início</span>
    </button>

    <!-- Gráficos -->
    <button onclick="location.href='report-transactions.html'" class="flex flex-col items-center p-2 text-gray-500 hover:text-blue-600">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
      </svg>
      <span class="text-xs font-medium" data-i18n="nav.charts">Objectivos</span>
    </button>

    <!-- Carteira -->
    <button onclick="location.href='wallet360.html'" class="flex flex-col items-center p-2 text-gray-500 hover:text-blue-600">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
      </svg>
      <span class="text-xs font-medium" data-i18n="nav.wallet">Carteira</span>
    </button>

    <!-- Conta -->
    <button onclick="location.href='settings.html'" class="flex flex-col items-center p-2 text-gray-500 hover:text-blue-600">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
      <span class="text-xs font-medium" data-i18n="nav.account">Conta</span>
    </button>
  </div>
</nav>

 <div id="footer-widget"></div>
  <script type="module" src="footer.js"></script>
  <script type="module">
 import './firebase-init.js';
import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import FirebaseAPI from './firebaseApi.js';

const auth = getAuth();
const form = document.getElementById('form');
const list = document.getElementById('list');
const btnText = document.getElementById('btnText');
const assetCount = document.getElementById('assetCount');
const totalValue = document.getElementById('totalValue');
const searchInput = document.getElementById('searchInput');
const filterType = document.getElementById('filterType');
const filterRisk = document.getElementById('filterRisk');
const emptyState = document.getElementById('emptyState');

let editingId = null;
let allAssets = [];

function applyFilters(arr) {
  const term = searchInput.value.toLowerCase();
  const tF = filterType.value;
  const rF = filterRisk.value;
  return arr.filter(a =>
    (!tF || a.type === tF) &&
    (!rF || a.risk === rF) &&
    (a.name.toLowerCase().includes(term) ||
     a.sector.toLowerCase().includes(term) ||
     a.country.toLowerCase().includes(term))
  );
}

function updateDisplay() {
  const filtered = applyFilters(allAssets);
  if (!filtered.length) {
    list.innerHTML = '';
    emptyState.classList.remove('hidden');
  } else {
    emptyState.classList.add('hidden');
    list.innerHTML = filtered.map(a => {
      const total = (a.quantity * a.priceUSD).toFixed(2);
      const chCls = a.change >= 0 ? 'text-green-600' : 'text-red-600';
      const icon = a.change >= 0 ? '↗' : '↘';
      return `
        <tr class="hover:bg-gray-50 transition-colors duration-200 animate-fade-in">
          <td class="p-4">${a.name}</td>
          <td class="p-4">${a.type}</td>
          <td class="p-4">${a.sector}</td>
          <td class="p-4">${a.country}</td>
          <td class="p-4">${a.risk}</td>
          <td class="p-4">${a.quantity}</td>
          <td class="p-4">$${a.priceUSD.toFixed(2)}</td>
          <td class="p-4"><span class="${chCls}">${icon} ${Math.abs(a.change).toFixed(2)}%</span></td>
          <td class="p-4">$${total}</td>
          <td class="p-4 space-x-2">
            <button onclick="editAsset('${a.id}')" class="text-blue-600 hover:text-blue-800">✏️</button>
            <button onclick="deleteAsset('${a.id}')" class="text-red-600 hover:text-red-800">🗑️</button>
          </td>
        </tr>`;
    }).join('');
  }
  const sum = allAssets.reduce((s, a) => s + a.quantity * a.priceUSD, 0);
  assetCount.textContent = allAssets.length;
  totalValue.textContent = sum.toFixed(2);
}

function updateAssets() {
  FirebaseAPI.fetchAssetsData()
    .then(assets => {
      allAssets = assets;
      updateDisplay();
    })
    .catch(err => console.error('Erro ao ler assets:', err));
}

form.addEventListener('submit', async e => {
  e.preventDefault();
  const data = {
    name: form.name.value,
    type: form.type.value,
    sector: form.sector.value,
    country: form.country.value,
    risk: form.risk.value,
    quantity: parseFloat(form.quantity.value),
    priceUSD: parseFloat(form.priceUSD.value),
    change: parseFloat(form.change.value) || 0
  };
  if (editingId) {
    await FirebaseAPI.updateAsset(editingId, data);
    editingId = null;
    btnText.textContent = 'Salvar';
  } else {
    await FirebaseAPI.addAsset(data);
  }
  form.reset();
  updateAssets();
});

// funções de edição e remoção
window.editAsset = id => {
  const a = allAssets.find(x => x.id === id);
  if (!a) return;
  editingId = id;
  form.name.value    = a.name;
  form.type.value    = a.type;
  form.sector.value  = a.sector;
  form.country.value = a.country;
  form.risk.value    = a.risk;
  form.quantity.value= a.quantity;
  form.priceUSD.value= a.priceUSD;
  form.change.value  = a.change;
  btnText.textContent= 'Atualizar';
  form.name.focus();
};

window.deleteAsset = async id => {
  if (confirm('Excluir este ativo?')) {
    try {
      await FirebaseAPI.deleteAsset(id);
      updateAssets();
    } catch (err) {
      console.error('Erro ao apagar ativo:', err);
    }
  }
};

[searchInput, filterType, filterRisk].forEach(el =>
  el.addEventListener('input', updateDisplay)
);

// só inicia após autenticação
onAuthStateChanged(auth, user => {
  if (user) {
    updateAssets();
  } else {
    console.log('Aguardando login...');
  }
}); 
  </script>
</body>
</html>
