<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Ativos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.4s ease-out',
            'bounce-in': 'bounceIn 0.6s ease-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'scale-in': 'scaleIn 0.2s ease-out',
            'pulse-glow': 'pulseGlow 2s infinite',
            'float': 'float 3s ease-in-out infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(-20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            bounceIn: {
              '0%': { transform: 'scale(0.8)', opacity: '0' },
              '50%': { transform: 'scale(1.05)', opacity: '1' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
            scaleIn: {
              '0%': { transform: 'scale(0.95)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
            pulseGlow: {
              '0%,100%': { boxShadow: '0 0 20px rgba(59,130,246,0.3)' },
              '50%': { boxShadow: '0 0 30px rgba(59,130,246,0.6)' },
            },
            float: {
              '0%,100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-5px)' },
            },
          },
        },
      },
    };
  </script>
  <style>
    .glass-effect {
      backdrop-filter: blur(16px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .glass-card {
      backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
    }
    
    .floating-shadow {
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                  0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
      overflow: hidden;
    }
    
    .gradient-bg::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.1;
    }
    
    .input-focus {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 12px;
    }
    
    .input-focus:focus {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      border-color: #3b82f6;
      outline: none;
    }
    
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .button-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: relative;
      overflow: hidden;
    }
    
    .button-gradient::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }
    
    .button-gradient:hover::before {
      left: 100%;
    }
    
    .table-row {
      transition: all 0.2s ease;
      border-left: 4px solid transparent;
    }
    
    .table-row:hover {
      background: linear-gradient(90deg, rgba(59,130,246,0.05), rgba(147,51,234,0.05));
      border-left-color: #3b82f6;
      transform: translateX(4px);
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.3);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .form-section {
      background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
    }
    
    .filter-section {
      background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.88));
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .action-button {
      transition: all 0.2s ease;
      border-radius: 8px;
      padding: 8px 12px;
      border: 1px solid transparent;
    }
    
    .action-button:hover {
      background: rgba(59,130,246,0.1);
      border-color: rgba(59,130,246,0.3);
      transform: scale(1.05);
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 500;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .risk-low { background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #166534; }
    .risk-medium { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
    .risk-high { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b; }
    
    .type-badge {
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
      color: #1e40af;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .mobile-optimized {
      padding: 1rem;
    }
    
    @media (max-width: 768px) {
      .mobile-optimized {
        padding: 0.5rem;
      }
      
      .table-responsive {
        font-size: 0.875rem;
      }
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-message {
      background: linear-gradient(135deg, #dcfce7, #bbf7d0);
      color: #166534;
      padding: 12px 20px;
      border-radius: 12px;
      border: 1px solid rgba(34, 197, 94, 0.3);
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .empty-state {
      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
      backdrop-filter: blur(20px);
      border: 2px dashed rgba(156, 163, 175, 0.5);
      border-radius: 16px;
      padding: 3rem;
      text-align: center;
    }
  </style>
</head>
<body class="min-h-screen gradient-bg">
  <div class="glass-effect sticky top-0 z-50 animate-slide-in" id="header-widget"></div>
  <script type="module" src="header.js"></script>
  
  <!-- Enhanced Header -->
  <header class="glass-effect sticky top-0 z-10 animate-slide-in">
    <div class="container mx-auto px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center animate-float">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gray-800">Gestão de Ativos</h1>
            <p class="text-sm text-gray-600">Controle inteligente do seu portfólio</p>
          </div>
        </div>
        
        <div class="flex space-x-4">
          <div class="stat-card rounded-2xl px-4 py-3 text-center">
            <div class="text-2xl font-bold text-green-600" id="assetCount">0</div>
            <div class="text-sm text-gray-600">Ativos</div>
          </div>
          <div class="stat-card rounded-2xl px-4 py-3 text-center">
            <div class="text-2xl font-bold text-blue-600">$<span id="totalValue">0.00</span></div>
            <div class="text-sm text-gray-600">Valor Total</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-6 py-8 space-y-8">
    <!-- Success Message -->
    <div id="successMessage" class="success-message hidden">
      <div class="flex items-center">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        <span id="successText">Ativo salvo com sucesso!</span>
      </div>
    </div>

    <!-- Enhanced Form -->
    <div class="form-section floating-shadow rounded-3xl p-8 animate-fade-in">
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-3">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-800">Adicionar Ativo</h2>
            <p class="text-gray-600">Adicione um novo ativo ao seu portfólio</p>
          </div>
        </div>
        <button type="button" id="clearForm" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <form id="form" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Nome do Ativo</label>
            <input id="name" placeholder="Ex: Apple Inc." class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" required />
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Tipo</label>
            <select id="type" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" required>
              <option value="">Selecione o tipo...</option>
              <option value="Ação">🏢 Ação</option>
              <option value="Criptomoeda">₿ Criptomoeda</option>
              <option value="ETF">📊 ETF</option>
              <option value="Obrigação">📈 Obrigação</option>
              <option value="Commodity">🥇 Commodity</option>
              <option value="REIT">🏠 REIT</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Setor</label>
            <input id="sector" placeholder="Ex: Tecnologia" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" />
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">País</label>
            <input id="country" placeholder="Ex: Estados Unidos" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" />
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Nível de Risco</label>
            <select id="risk" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white">
              <option value="">Selecione o risco...</option>
              <option value="Baixo">🟢 Baixo</option>
              <option value="Médio">🟡 Médio</option>
              <option value="Alto">🔴 Alto</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Quantidade</label>
            <input id="quantity" type="number" step="0.01" min="0" placeholder="0.00" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" required />
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Preço (USD)</label>
            <input id="priceUSD" type="number" step="0.01" min="0" placeholder="0.00" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" required />
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Variação (%)</label>
            <input id="change" type="number" step="0.01" placeholder="0.00" class="w-full border-2 border-gray-200 p-4 rounded-xl input-focus bg-white" />
          </div>
        </div>
        
        <button type="submit" id="btnText" class="w-full button-gradient text-white p-4 rounded-xl hover-lift text-lg font-medium">
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Salvar Ativo
          </span>
        </button>
      </form>
    </div>

    <!-- Enhanced Filters -->
    <div class="filter-section floating-shadow rounded-3xl p-6 animate-fade-in">
      <div class="flex items-center mb-4">
        <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"/>
        </svg>
        <h3 class="text-lg font-semibold text-gray-800">Filtros e Pesquisa</h3>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="relative">
          <svg class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input id="searchInput" placeholder="Pesquisar ativos..." class="w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl input-focus bg-white" />
        </div>
        
        <select id="filterType" class="border-2 border-gray-200 p-3 rounded-xl input-focus bg-white">
          <option value="">Todos os Tipos</option>
          <option value="Ação">🏢 Ação</option>
          <option value="Criptomoeda">₿ Criptomoeda</option>
          <option value="ETF">📊 ETF</option>
          <option value="Obrigação">📈 Obrigação</option>
          <option value="Commodity">🥇 Commodity</option>
          <option value="REIT">🏠 REIT</option>
        </select>
        
        <select id="filterRisk" class="border-2 border-gray-200 p-3 rounded-xl input-focus bg-white">
          <option value="">Todos os Riscos</option>
          <option value="Baixo">🟢 Baixo</option>
          <option value="Médio">🟡 Médio</option>
          <option value="Alto">🔴 Alto</option>
        </select>
      </div>
    </div>

    <!-- Enhanced Table -->
    <div class="glass-card floating-shadow rounded-3xl overflow-hidden animate-fade-in">
      <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">Seus Ativos</h3>
        <p class="text-sm text-gray-600">Gerencie seu portfólio de investimentos</p>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full table-responsive">
          <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
            <tr class="border-b border-gray-200">
              <th class="p-4 text-left font-semibold text-gray-700">Nome</th>
              <th class="p-4 text-center font-semibold text-gray-700">Tipo</th>
              <th class="p-4 text-center font-semibold text-gray-700">Setor</th>
              <th class="p-4 text-center font-semibold text-gray-700">País</th>
              <th class="p-4 text-center font-semibold text-gray-700">Risco</th>
              <th class="p-4 text-center font-semibold text-gray-700">Quantidade</th>
              <th class="p-4 text-center font-semibold text-gray-700">Preço</th>
              <th class="p-4 text-center font-semibold text-gray-700">Variação</th>
              <th class="p-4 text-center font-semibold text-gray-700">Total</th>
              <th class="p-4 text-center font-semibold text-gray-700">Ações</th>
            </tr>
          </thead>
          <tbody id="list" class="divide-y divide-gray-100"></tbody>
        </table>
        
        <div id="emptyState" class="empty-state m-8 hidden">
          <div class="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center">
            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">Nenhum ativo encontrado</h3>
          <p class="text-gray-500 mb-4">Comece adicionando seu primeiro ativo ao portfólio</p>
          <button type="button" onclick="document.getElementById('name').focus()" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Adicionar Ativo
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Enhanced Mobile Navigation -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-200 z-50 md:hidden">
    <div class="flex justify-around py-2">
      <button onclick="location.href='index.html'" class="flex flex-col items-center p-3 text-blue-600 hover:text-blue-700 transition-colors">
        <div class="w-6 h-6 mb-1">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
          </svg>
        </div>
        <span class="text-xs font-medium">Objetivos</span>
      </button>

      <button onclick="location.href='wallet360.html'" class="flex flex-col items-center p-3 text-gray-500 hover:text-blue-600 transition-colors">
        <div class="w-6 h-6 mb-1">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
          </svg>
        </div>
        <span class="text-xs font-medium">Carteira</span>
      </button>

      <button onclick="location.href='settings.html'" class="flex flex-col items-center p-3 text-gray-500 hover:text-blue-600 transition-colors">
        <div class="w-6 h-6 mb-1">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <span class="text-xs font-medium">Conta</span>
      </button>
    </div>
  </nav>

  <div id="footer-widget"></div>
  <script type="module" src="footer.js"></script>
  
  <script type="module">
    import './firebase-init.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
    import FirebaseAPI from './firebaseApi.js';

    const auth = getAuth();
    const form = document.getElementById('form');
    const list = document.getElementById('list');
    const btnText = document.getElementById('btnText');
    const assetCount = document.getElementById('assetCount');
    const totalValue = document.getElementById('totalValue');
    const searchInput = document.getElementById('searchInput');
    const filterType = document.getElementById('filterType');
    const filterRisk = document.getElementById('filterRisk');
    const emptyState = document.getElementById('emptyState');
    const successMessage = document.getElementById('successMessage');
    const successText = document.getElementById('successText');
    const clearForm = document.getElementById('clearForm');

    let editingId = null;
    let allAssets = [];

    // Show success message
    function showSuccess(message) {
      successText.textContent = message;
      successMessage.classList.remove('hidden');
      setTimeout(() => {
        successMessage.classList.add('hidden');
      }, 3000);
    }

    // Clear form function
    clearForm.addEventListener('click', () => {
      form.reset();
      editingId = null;
      btnText.innerHTML = `
        <span class="flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Salvar Ativo
        </span>
      `;
    });

    function getRiskBadgeClass(risk) {
      switch(risk) {
        case 'Baixo': return 'risk-low';
        case 'Médio': return 'risk-medium';
        case 'Alto': return 'risk-high';
        default: return 'status-badge';
      }
    }

    function getTypeIcon(type) {
      const icons = {
        'Ação': '🏢',
        'Criptomoeda': '₿',
        'ETF': '📊',
        'Obrigação': '📈',
        'Commodity': '🥇',
        'REIT': '🏠'
      };
      return icons[type] || '📊';
    }

    function applyFilters(arr) {
      const term = searchInput.value.toLowerCase();
      const tF = filterType.value;
      const rF = filterRisk.value;
      return arr.filter(a =>
        (!tF || a.type === tF) &&
        (!rF || a.risk === rF) &&
        (a.name.toLowerCase().includes(term) ||
         a.sector.toLowerCase().includes(term) ||
         a.country.toLowerCase().includes(term))
      );
    }

    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-PT', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2
      }).format(value);
    }

    function updateDisplay() {
      const filtered = applyFilters(allAssets);
      
      if (!filtered.length) {
        list.innerHTML = '';
        emptyState.classList.remove('hidden');
      } else {
        emptyState.classList.add('hidden');
        list.innerHTML = filtered.map((a, index) => {
          const total = a.quantity * a.priceUSD;
          const changeClass = a.change >= 0 ? 'text-green-600' : 'text-red-600';
          const changeIcon = a.change >= 0 ? '📈' : '📉';
          const riskClass = getRiskBadgeClass(a.risk);
          const typeIcon = getTypeIcon(a.type);
          
          return `
            <tr class="table-row animate-scale-in" style="animation-delay: ${index * 0.1}s">
              <td class="p-4">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl flex items-center justify-center mr-3">
                    <span class="text-lg">${typeIcon}</span>
                  </div>
                  <div>
                    <div class="font-semibold text-gray-900">${a.name}</div>
                    <div class="text-sm text-gray-500">${a.sector || 'N/A'}</div>
                  </div>
                </div>
              </td>
              <td class="p-4 text-center">
                <span class="type-badge">${a.type}</span>
              </td>
              <td class="p-4 text-center text-gray-600">${a.sector || 'N/A'}</td>
              <td class="p-4 text-center text-gray-600">${a.country || 'N/A'}</td>
              <td class="p-4 text-center">
                <span class="status-badge ${riskClass}">${a.risk || 'N/A'}</span>
              </td>
              <td class="p-4 text-center font-medium">${a.quantity.toLocaleString()}</td>
              <td class="p-4 text-center font-medium">${formatCurrency(a.priceUSD)}</td>
              <td class="p-4 text-center">
                <span class="flex items-center justify-center ${changeClass} font-medium">
                  <span class="mr-1">${changeIcon}</span>
                  ${Math.abs(a.change).toFixed(2)}%
                </span>
              </td>
              <td class="p-4 text-center font-bold text-lg">${formatCurrency(total)}</td>
              <td class="p-4 text-center">
                <div class="flex items-center justify-center space-x-2">
                  <button onclick="editAsset('${a.id}')" class="action-button text-blue-600 hover:text-blue-800" title="Editar">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                  </button>
                  <button onclick="deleteAsset('${a.id}')" class="action-button text-red-600 hover:text-red-800" title="Excluir">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }
      
      const sum = allAssets.reduce((s, a) => s + a.quantity * a.priceUSD, 0);
      assetCount.textContent = allAssets.length.toLocaleString();
      totalValue.textContent = sum.toLocaleString('pt-PT', { minimumFractionDigits: 2 });
    }

    function updateAssets() {
      FirebaseAPI.fetchAssetsData()
        .then(assets => {
          allAssets = assets;
          updateDisplay();
        })
        .catch(err => {
          console.error('Erro ao ler assets:', err);
          showSuccess('Erro ao carregar ativos');
        });
    }

    // Enhanced form submission
    form.addEventListener('submit', async e => {
      e.preventDefault();
      
      // Show loading state
      const originalText = btnText.innerHTML;
      btnText.innerHTML = '<div class="loading-spinner"></div>';
      btnText.disabled = true;
      
      try {
        const data = {
          name: form.name.value,
          type: form.type.value,
          sector: form.sector.value,
          country: form.country.value,
          risk: form.risk.value,
          quantity: parseFloat(form.quantity.value),
          priceUSD: parseFloat(form.priceUSD.value),
          change: parseFloat(form.change.value) || 0
        };
        
        if (editingId) {
          await FirebaseAPI.updateAsset(editingId, data);
          showSuccess('Ativo atualizado com sucesso!');
          editingId = null;
          btnText.innerHTML = originalText;
        } else {
          await FirebaseAPI.addAsset(data);
          showSuccess('Ativo adicionado com sucesso!');
        }
        
        form.reset();
        updateAssets();
        
      } catch (error) {
        console.error('Erro ao salvar ativo:', error);
        showSuccess('Erro ao salvar ativo');
      } finally {
        btnText.disabled = false;
        if (!editingId) {
          btnText.innerHTML = originalText;
        }
      }
    });

    // Edit asset function
    window.editAsset = id => {
      const a = allAssets.find(x => x.id === id);
      if (!a) return;
      
      editingId = id;
      form.name.value = a.name;
      form.type.value = a.type;
      form.sector.value = a.sector;
      form.country.value = a.country;
      form.risk.value = a.risk;
      form.quantity.value = a.quantity;
      form.priceUSD.value = a.priceUSD;
      form.change.value = a.change;
      
      btnText.innerHTML = `
        <span class="flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          Atualizar Ativo
        </span>
      `;
      
      form.name.focus();
      form.scrollIntoView({ behavior: 'smooth' });
    };

    // Delete asset function
    window.deleteAsset = async id => {
      const asset = allAssets.find(x => x.id === id);
      if (!asset) return;
      
      if (confirm(`Tem certeza que deseja excluir "${asset.name}"?`)) {
        try {
          await FirebaseAPI.deleteAsset(id);
          showSuccess('Ativo excluído com sucesso!');
          updateAssets();
        } catch (err) {
          console.error('Erro ao apagar ativo:', err);
          showSuccess('Erro ao excluir ativo');
        }
      }
    };

    // Filter event listeners
    [searchInput, filterType, filterRisk].forEach(el =>
      el.addEventListener('input', updateDisplay)
    );

    // Initialize when authenticated
    onAuthStateChanged(auth, user => {
      if (user) {
        updateAssets();
      } else {
        console.log('Aguardando login...');
      }
    });
  </script>
</body>
</html>
