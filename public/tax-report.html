<!DOCTYPE html><html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Relat√≥rio Fiscal & Simula√ß√£o - NovaStocks</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Header Din√¢mico -->
  <div id="header-widget" data-config='{"title":"NovaStocks","logoUrl":"/assets/logo.png","links":[{"icon":"üè†","label":"Home","href":"index.html"},{"icon":"üíº","label":"Conta","href":"settings.html"},{"icon":"üìã","label":"Relat√≥rios","href":"report-transactions.html"},{"icon":"‚úâÔ∏è","label":"Contactos","href":"contact.html"}]}'></div>
  <script type="module" src="header.js"></script>  <main class="max-w-6xl mx-auto py-12 px-6 space-y-16">
    <!-- Se√ß√£o: Relat√≥rio Fiscal -->
    <section id="fiscal-report">
      <h2 class="text-3xl font-semibold mb-6 text-center">Relat√≥rio Fiscal</h2>
      <div class="bg-white rounded-lg shadow p-8">
        <form id="fiscalForm" class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
          <div>
            <label for="year" class="block mb-1 font-medium">Ano Fiscal</label>
            <select id="year" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
              <option value="2023">2023</option>
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
            </select>
          </div>
          <div>
            <label for="format" class="block mb-1 font-medium">Formato</label>
            <select id="format" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
              <option value="pdf">PDF</option>
              <option value="csv">CSV</option>
            </select>
          </div>
          <button type="button" id="generateFiscal" class="col-span-1 md:col-span-1 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition">
            Gerar Relat√≥rio
          </button>
        </form>
      </div>
    </section><!-- Se√ß√£o: Simula√ß√£o de Impostos -->
<section id="tax-sim">
  <h2 class="text-3xl font-semibold mb-6 text-center">Simula√ß√£o de Impostos</h2>
  <div class="bg-white rounded-lg shadow p-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Formul√°rio Simula√ß√£o -->
    <div>
      <form id="simForm" class="space-y-4">
        <div>
          <label for="gain" class="block mb-1 font-medium">Ganho de Capital (‚Ç¨)</label>
          <input type="number" id="gain" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Ex: 10000" />
        </div>
        <div>
          <label for="costs" class="block mb-1 font-medium">Custos (Taxas, Corretagem) (‚Ç¨)</label>
          <input type="number" id="costs" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Ex: 150" />
        </div>
        <div>
          <label for="rate" class="block mb-1 font-medium">Taxa de Imposto (%)</label>
          <input type="number" id="rate" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Ex: 28" />
        </div>
        <button type="button" id="simulate" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
          Simular
        </button>
      </form>
    </div>
    <!-- Resultados -->
    <div class="bg-blue-50 rounded-lg p-6">
      <h3 class="text-xl font-medium mb-4">Resultados da Simula√ß√£o</h3>
      <p>Imposto Devido: <span id="taxDue" class="font-semibold">‚Ç¨0.00</span></p>
      <p>Lucro L√≠quido: <span id="netProfit" class="font-semibold">‚Ç¨0.00</span></p>
    </div>
  </div>
</section>

<!-- Se√ß√£o: Gr√°ficos -->
<section id="charts">
  <h2 class="text-3xl font-semibold mb-6 text-center">Gr√°ficos de Transa√ß√µes</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-xl font-medium mb-4">Volume por Dia (‚Ç¨)</h3>
      <canvas id="volumeChart" height="200"></canvas>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-xl font-medium mb-4">Dividendos por Dia (‚Ç¨)</h3>
      <canvas id="dividendChart" height="200"></canvas>
    </div>
  </div>
</section>

  </main>  <footer class="bg-gray-800 text-gray-400 py-6">
    <div class="max-w-6xl mx-auto px-6 text-center">
      <p>&copy; 2025 NovaStocks. Todos os direitos reservados.</p>
    </div>
  </footer>  <script>
    // Gera√ß√£o de Relat√≥rio Fiscal (exemplo)
    document.getElementById('generateFiscal').addEventListener('click', () => {
      const year = document.getElementById('year').value;
      const format = document.getElementById('format').value;
      alert(`Gerando relat√≥rio fiscal ${year} em ${format.toUpperCase()}`);
      // TODO: integrar chamada √† API para download real
    });

    // Simula√ß√£o de Impostos
    document.getElementById('simulate').addEventListener('click', () => {
      const gain = parseFloat(document.getElementById('gain').value) || 0;
      const costs = parseFloat(document.getElementById('costs').value) || 0;
      const rate = parseFloat(document.getElementById('rate').value) || 0;
      const taxable = gain - costs;
      const tax = (taxable * rate) / 100;
      const net = taxable - tax;
      document.getElementById('taxDue').textContent = `‚Ç¨${tax.toFixed(2)}`;
      document.getElementById('netProfit').textContent = `‚Ç¨${net.toFixed(2)}`;
    });

    // Carregar dados e renderizar gr√°ficos
    async function loadGraphData() {
      try {
        const res = await fetch('/api/transactions?user=default');
        const data = await res.json();
        renderGraphs(data);
      } catch (e) {
        console.error('Erro ao carregar transa√ß√µes para gr√°ficos', e);
      }
    }

    function renderGraphs(data) {
      const volumesByDate = {};
      const dividendsByDate = {};

      data.forEach(tx => {
        // Volume para compras e vendas
        if (tx.operation.toLowerCase() === 'compra' || tx.operation.toLowerCase() === 'venda') {
          volumesByDate[tx.date] = (volumesByDate[tx.date] || 0) + (tx.price * tx.quantity);
        }
        // Dividendos (assume campo tx.amount)
        if (tx.operation.toLowerCase() === 'dividendo' && tx.amount) {
          dividendsByDate[tx.date] = (dividendsByDate[tx.date] || 0) + tx.amount;
        }
      });

      const sortedDates = Object.keys(volumesByDate).sort();
      const volValues = sortedDates.map(d => volumesByDate[d]);

      const ctxVol = document.getElementById('volumeChart').getContext('2d');
      new Chart(ctxVol, {
        type: 'bar',
        data: { labels: sortedDates, datasets: [{ label: 'Volume (‚Ç¨)', data: volValues }] },
        options: { responsive: true }
      });

      const divDates = Object.keys(dividendsByDate).sort();
      const divValues = divDates.map(d => dividendsByDate[d]);
      const ctxDiv = document.getElementById('dividendChart').getContext('2d');
      new Chart(ctxDiv, {
        type: 'line',
        data: { labels: divDates, datasets: [{ label: 'Dividendos (‚Ç¨)', data: divValues, fill: false, tension: 0.1 }] },
        options: { responsive: true }
      });
    }

    document.addEventListener('DOMContentLoaded', loadGraphData);
  </script></body>
</html>
