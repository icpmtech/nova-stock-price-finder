<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zacks Analysis / An√°lise Zacks</title>
  <!-- External CSS -->
  <link rel="stylesheet" href="app-zack.css">
  <link rel="stylesheet" href="nav.css">
  <link rel="stylesheet" href="app-mah.css">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- Primary navbar -->
  <header class="mah-navbar bg-white shadow">
    <div class="mah-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <button id="burger" class="burger text-2xl md:hidden">‚ò∞</button>
      <a href="/" class="mah-brand flex items-center space-x-2">
        <span class="mah-icon text-2xl">üìà</span>
        <span class="hero-title mah-name text-xl font-semibold">Nova Markets Hub</span>
      </a>
      <nav class="mah-nav hidden md:flex space-x-4">
        <a href="https://marketanalyticshubapp.azurewebsites.net/#home" class="text-gray-700 hover:text-blue-600">Home</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#features" class="text-gray-700 hover:text-blue-600">Features</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#team" class="text-gray-700 hover:text-blue-600">Team</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#pricing" class="text-gray-700 hover:text-blue-600">Pricing</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#faq" class="text-gray-700 hover:text-blue-600">FAQ</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#contact" class="text-gray-700 hover:text-blue-600">Contact Us</a>
        <a href="https://marketanalyticshubapp.azurewebsites.net/#help" class="text-gray-700 hover:text-blue-600">Help Center</a>
        <a href="https://nova-search-stock.netlify.app/" class="text-gray-700 hover:text-blue-600">Simulate Strategy</a>
    
      </nav>
      <div class="flex items-center space-x-4">
        <a href="Account/Login" target="_blank" class="mah-cta px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          <span class="mah-cta-icon">‚Üª</span> Login/Register
        </a>
        <div class="lang-switcher flex items-center space-x-1 ml-4 text-sm">
          <button data-lang="pt" class="active font-semibold underline">PT</button>
          <span class="text-gray-400">|</span>
          <button data-lang="en" class="text-gray-600">EN</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Secondary navbar -->
  <header class="mah-navbar bg-gray-100">
    <div class="mah-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="mah-nav flex space-x-4 py-3">
        <a href="index.html" class="mah-link text-gray-700 hover:text-blue-600">Home</a>
        <a href="zack.html" class="mah-link text-blue-600 font-semibold">Zacks Analysis</a>
        <a href="stocks.html" class="mah-link text-gray-700 hover:text-blue-600">Stocks List</a>
      </nav>
    </div>
  </header>

  <!-- Page heading -->
  <div class="header max-w-3xl mx-auto p-6">
    <h2 id="mainTitle" class="text-3xl font-bold">üìà An√°lise Zacks</h2>
    <p id="subTitle" class="text-gray-600 mt-1">An√°lise profissional de a√ß√µes baseada no framework Zacks</p>
  </div>

  <!-- Spinner overlay -->
  <div class="loading-overlay fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 hidden" id="loadingOverlay">
    <div class="loading-spinner w-12 h-12 border-4 border-blue-600 border-dashed rounded-full animate-spin"></div>
  </div>

  <!-- Core content -->
  <main class="container max-w-3xl mx-auto p-6">
    <div class="content space-y-6">
      <div class="input-section">
        <div class="form-group">
          <label for="ticker" id="tickerLabel" class="block text-lg font-medium">üéØ Ticker da A√ß√£o</label>
          <div class="input-wrapper mt-2 flex">
            <input type="text" id="ticker" placeholder="Digite o ticker (ex: AAPL, TSLA, VALE)" class="flex-1 border rounded-l px-3 py-2" />
            <button class="analyze-btn bg-blue-600 text-white px-4 py-2 rounded-r hover:bg-blue-700 flex items-center" id="analyzeBtn">
              <span class="spinner mr-2 hidden" id="spinner"></span>
              <span id="btnText">Analisar</span>
            </button>
          </div>
        </div>
      </div>

      <div class=" bg-white rounded shadow p-6 hidden" id="results">
        <div class="results-header mb-4">
          <h2 id="resultsHeader" class="text-2xl font-semibold">üìä Resultados da An√°lise</h2>
        </div>
        <div class="results-content space-y-6">
          <div class="metrics-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblPrice">üí∞ Pre√ßo Atual</div>
              <div class="metric-value text-xl font-bold mt-1" id="price">-</div>
            </div>
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblChange">üìà Varia√ß√£o %</div>
              <div class="metric-value text-xl font-bold mt-1" id="changePercent">-</div>
            </div>
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblVolume">üìä Volume</div>
              <div class="metric-value text-xl font-bold mt-1" id="volume">-</div>
            </div>
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblMarketCap">üè¢ Market Cap</div>
              <div class="metric-value text-xl font-bold mt-1" id="marketCap">-</div>
            </div>
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblFPE">üîÆ PE (Forward)</div>
              <div class="metric-value text-xl font-bold mt-1" id="forwardPE">-</div>
            </div>
            <div class="metric-card bg-gray-50 p-4 rounded shadow">
              <div class="metric-label font-medium" id="lblFSales">üíº Sales (Forward)</div>
              <div class="metric-value text-xl font-bold mt-1" id="forwardSales">-</div>
            </div>
          </div>

          <div class="zacks-rank bg-white p-6 rounded shadow flex flex-col items-center text-center" id="zacksRankCard">
            <div class="rank-number text-5xl font-bold text-blue-600 mb-2" id="zacksRank">-</div>
            <div class="rank-title text-xl font-semibold" id="rankTitle">Zacks Rank</div>
            <div class="rank-description text-gray-600 mt-2" id="rankExplanation">-</div>
          </div>

          <div class="valuation bg-white p-6 rounded shadow">
            <h3 id="valuationHeading" class="text-xl font-semibold mb-2">üéØ An√°lise de Valuation</h3>
            <div class="valuation-text text-gray-700" id="valuation">-</div>
          </div>
        </div>
      </div>
    </div>
  </main>
 <footer class="bg-white mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Footer content here... reuse Tailwind classes as needed -->
      <p class="text-center text-gray-500">¬© <script>document.write(new Date().getFullYear());</script> cantinhodedotnet. Made with ‚ù§Ô∏è for a better web.</p>
    </div>
  </footer>
  <!-- Translation + init + core JS -->
  <script>
    async function fetchQuote(symbol) {
      const resp = await fetch(`/api?symbol=${symbol}`);
      if (!resp.ok) throw new Error('Falha ao obter dados da API');
      return resp.json();
    }
    function getRankExplanation(rank) {
      switch(rank) {
        case 1: return 'Strong Buy: Analistas esperam que a a√ß√£o supere o mercado.';
        case 2: return 'Buy: Expectativa de performance acima da m√©dia do mercado.';
        case 3: return 'Hold: Performance esperada em linha com o mercado.';
        case 4: return 'Sell: Performance esperada abaixo da m√©dia do mercado.';
        case 5: return 'Strong Sell: Analistas recomendam venda, pois desempenho dever√° ficar abaixo do mercado.';
        default: return '-';
      }
    }
    function computeZacksRankFromQuote(q) {
      const momentumScore = q.changePercent >= 0 ? 1 : 5;
      let safetyScore;
      if (q.marketCap >= 1e10) safetyScore = 1;
      else if (q.marketCap >= 2e9) safetyScore = 2;
      else if (q.marketCap >= 3e8) safetyScore = 3;
      else safetyScore = 4;
      const valueScore = Math.max(1, Math.min(5, Math.round(q.price / 100)));
      const growthScore = 3;
      return Math.round((valueScore + growthScore + momentumScore + safetyScore) / 4);
    }
    function getRankTitle(rank) {
      return ['Zacks Rank','Strong Buy','Buy','Hold','Sell','Strong Sell'][rank] || 'Zacks Rank';
    }
    function updateRankCardStyle(rank) {
      const card = document.getElementById('zacksRankCard');
      card.className = `zacks-rank rank-${rank} bg-gray-50 p-6 rounded shadow flex flex-col items-center text-center`;
    }
    function formatNumber(num) {
      if (num >= 1e12) return (num/1e12).toFixed(2)+'T';
      if (num >= 1e9) return (num/1e9).toFixed(2)+'B';
      if (num >= 1e6) return (num/1e6).toFixed(2)+'M';
      if (num >= 1e3) return (num/1e3).toFixed(2)+'K';
      return num.toLocaleString();
    }
    function formatPercentage(pct) {
      const v = (pct*100).toFixed(2);
      const cls = pct>=0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
      return `<span class="${cls}">${pct>=0?'+':''}${v}%</span>`;
    }
    function showLoading() {
      document.getElementById('analyzeBtn').disabled = true;
      document.getElementById('spinner').classList.remove('hidden');
      document.getElementById('btnText').textContent = 'Analisando...';
      document.getElementById('loadingOverlay').classList.remove('hidden');
    }
    function hideLoading() {
      document.getElementById('analyzeBtn').disabled = false;
      document.getElementById('spinner').classList.add('hidden');
      document.getElementById('btnText').textContent = 'Analisar';
      document.getElementById('loadingOverlay').classList.add('hidden');
    }
    function showResults() {
      document.getElementById('results').classList.remove('hidden');
      document.getElementById('results').scrollIntoView({behavior:'smooth', block:'start'});
    }
    function showError(msg) {
      const container = document.querySelector('#results .results-content');
      container.querySelectorAll('.error-message').forEach(el=>el.remove());
      const err = document.createElement('div');
      err.className = 'error-message text-red-600 mt-4';
      err.textContent = msg;
      container.appendChild(err);
      showResults();
    }
    // Translation init
    const t9n = { pt:{ /*...*/ }, en:{ /*...*/ } };
    let currentLang = localStorage.getItem('lang') || 'pt';
    const qs = s => document.querySelector(s);
    function setLang(lang) { /* ... apply translations ... */ }
    document.addEventListener('DOMContentLoaded', () => {
      setLang(currentLang);
      document.getElementById('analyzeBtn').addEventListener('click', async ()=>{
        const t = qs('#ticker').value.trim().toUpperCase();
        if(!t) { showError('‚ö†Ô∏è Por favor, insira um ticker v√°lido.'); return; }
        showLoading();
        try {
          await new Promise(res => setTimeout(res, 500));
          const q = await fetchQuote(t);
          document.getElementById('price').textContent = `$${formatNumber(q.price)}`;
          document.getElementById('changePercent').innerHTML = formatPercentage(q.changePercent);
          document.getElementById('volume').textContent = formatNumber(q.volume);
          document.getElementById('marketCap').textContent = `$${formatNumber(q.marketCap)}`;
          document.getElementById('forwardPE').textContent = q.forwardPE ? `${q.forwardPE.toFixed(1)}x` : 'N/A';
          document.getElementById('forwardSales').textContent = q.forwardSales ? `${q.forwardSales.toFixed(1)}x` : 'N/A';
          const rnk = computeZacksRankFromQuote(q);
          document.getElementById('zacksRank').textContent = rnk;
          document.getElementById('rankTitle').textContent = getRankTitle(rnk);
          document.getElementById('rankExplanation').textContent = getRankExplanation(rnk);
          updateRankCardStyle(rnk);
          // Valuation narrative
          if(q.forwardPE && q.forwardSales && q.industryAvgPE && q.industryAvgSales) {
            const peComp = q.forwardPE<q.industryAvgPE ? 'inferior' : 'superior';
            const salesComp = q.forwardSales<q.industryAvgSales ? 'inferior' : 'superior';
            const both = (q.forwardPE<q.industryAvgPE && q.forwardSales<q.industryAvgSales) ? 'inferiores' : 'superiores';
            const narrative = `üìä Do ponto de vista de valuation, ${t} negocia atualmente a ${q.forwardPE.toFixed(1)}x lucros futuros e ${q.forwardSales.toFixed(1)}x vendas futuras.<br><br>üìà O m√∫ltiplo P/E √© ${peComp} √† m√©dia da ind√∫stria (${q.industryAvgPE.toFixed(1)}x), enquanto o P/S √© ${salesComp} √† m√©dia setorial (${q.industryAvgSales.toFixed(1)}x).<br><br>üéØ Ambos os m√∫ltiplos s√£o ${both} √† m√©dia da ind√∫stria, indicando que a a√ß√£o est√° ${both==='inferiores'?'potencialmente subvalorizada':'potencialmente sobrevalorizada'} em rela√ß√£o aos pares do setor.`;
            document.getElementById('valuation').innerHTML = narrative;
          } else {
            document.getElementById('valuation').textContent = 'üìä Dados de valuation n√£o dispon√≠veis para an√°lise comparativa no momento.';
          }
          showResults();
        } catch(e) {
          console.error(e);
          showError('‚ùå Erro ao buscar dados da a√ß√£o. Verifique o ticker e tente novamente.');
        } finally {
          hideLoading();
        }
      });
      document.getElementById('ticker').focus();
    });
  </script>
</body>
</html>
